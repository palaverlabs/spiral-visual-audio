(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const l of e)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(e){const l={};return e.integrity&&(l.integrity=e.integrity),e.referrerPolicy&&(l.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?l.credentials="include":e.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(e){if(e.ep)return;e.ep=!0;const l=n(e);fetch(e.href,l)}})();const p=Math.PI*2,it=255,St=.97,_t=[6e3,8e3,11025,16e3,22050],Mt=2e6,j=8e3,ft=.005,bt=Math.PI,lt=2122,rt=1e3,Et=100,Rt=220,kt=40,At=260,It=260;function X(u,t,n){return Math.min(n,Math.max(t,u))}function gt(u,t,n){return t+(n-t)*u}function pt(u){return(u<0?-1:1)*Math.log(1+it*Math.abs(u))/Math.log(1+it)}function ht(u){return(u<0?-1:1)*((1+it)**Math.abs(u)-1)/it}function ut(u,t){if(t<=1)return u;const n=Math.min(Math.ceil(t*2),64),o=n*2+1,e=new Float32Array(o),l=.5/t;let i=0;for(let r=0;r<o;r++){const s=r-n;e[r]=s===0?l:Math.sin(Math.PI*l*s)/(Math.PI*s);const d=.42-.5*Math.cos(p*r/(o-1))+.08*Math.cos(2*p*r/(o-1));e[r]*=d,i+=e[r]}for(let r=0;r<o;r++)e[r]/=i;const a=new Float32Array(u.length);for(let r=0;r<u.length;r++){let s=0;for(let d=0;d<o;d++){const c=r+d-n;c>=0&&c<u.length&&(s+=u[c]*e[d])}a[r]=s}return a}function Ct(u){const t=new Float32Array(u.length);t[0]=u[0];for(let n=1;n<u.length;n++)t[n]=u[n]+St*t[n-1];return t}function Bt(u,t,n,o,e,l){const i=new Float32Array(u.length);let a=0,r=0,s=0,d=0;for(let c=0;c<u.length;c++){const h=t*u[c]+n*a+o*r-e*s-l*d;r=a,a=u[c],d=s,s=h,i[c]=h}return i}function wt(u,t,n,o=lt){const e=Math.pow(10,n/40),l=2*Math.PI*o/t,i=Math.cos(l),a=Math.sin(l)/Math.sqrt(2),r=2*Math.sqrt(e)*a,s=e*(e+1+(e-1)*i+r),d=-2*e*(e-1+(e+1)*i),c=e*(e+1+(e-1)*i-r),h=e+1-(e-1)*i+r,v=2*(e-1-(e+1)*i),m=e+1-(e-1)*i-r;return Bt(u,s/h,d/h,c/h,v/h,m/h)}function Pt(u,t,n=lt){return wt(u,t,20,n)}function Lt(u,t,n=lt){return wt(u,t,-20,n)}function $t(u,t,n,o,e){const l=-.5*u+1.5*t-1.5*n+.5*o,i=u-2.5*t+2*n-.5*o,a=-.5*u+.5*n,r=t;return l*e*e*e+i*e*e+a*e+r}function Ft(u,t,n=.85){const o=1-Math.exp(-1/(t*.01)),e=1-Math.exp(-1/(t*.5)),l=new Float32Array(u.length);let i=0;for(let a=0;a<u.length;a++){const r=Math.abs(u[a]),s=r>i?o:e;i=s*r+(1-s)*i;const d=i>n?n/i:1;l[a]=u[a]*d}return l}function Gt(u){const t=Math.abs(u);if(t>=3)return 0;if(t<1e-8)return 1;const n=Math.PI*u;return Math.sin(n)/n*(Math.sin(n/3)/(n/3))}function vt(u,t){const n=u.length,o=new Float32Array(t),e=(n-1)/Math.max(1,t-1);for(let l=0;l<t;l++){const i=l*e,a=Math.floor(i);let r=0,s=0;for(let d=a-2;d<=a+3;d++){if(d<0||d>=n)continue;const c=Gt(i-d);r+=u[d]*c,s+=c}o[l]=s>1e-8?r/s:0}return o}function Tt(u,t={}){const{sr:n=44100,quality:o=3,turns:e=6,sensitivity:l=5,Rout:i=220,Rin:a=40,cx:r=260,cy:s=260,rightChannel:d=null}=t,c=d!==null,h=u.length,v=h/n,m=_t[o-1],f=Math.min(Math.round(m*v),Mt,h),C=h/f,$=Math.round(f/v),T=b=>{const _=C>1?ut(b,C):b,F=new Float32Array(f);for(let O=0;O<f;O++)F[O]=X(_[Math.min(Math.floor(O*C),h-1)],-1,1);return Pt(Ft(F,$),$,rt)};let L,w;if(c){const b=d.length;L=new Float32Array(h),w=new Float32Array(h);for(let _=0;_<h;_++){const F=_<b?d[_]:0;L[_]=(u[_]+F)*.5,w[_]=(u[_]-F)*.5}}else L=u,w=null;const R=T(L),M=c?T(w):null;let S=0;for(let b=0;b<f;b++)S=Math.max(S,Math.abs(R[b])),M&&(S=Math.max(S,Math.abs(M[b])));if(S>1){const b=1/S;for(let _=0;_<f;_++)R[_]*=b,M&&(M[_]*=b)}const B=new Float32Array(f),A=c?new Float32Array(f):null;for(let b=0;b<f;b++)B[b]=pt(R[b]),A&&(A[b]=pt(M[b]));const q=.45*((i-a)/Math.max(1,e)),W=Math.min(l,q),P=Et,z=Math.round(r*P),U=Math.round(s*P),N=i*P,tt=a*P,K=W*P,et=new Array(f),G=new Float32Array(f*2);let H=0,D=0;for(let b=0;b<f;b++){const _=b/(f-1),F=_*e*p,O=gt(_,N,tt),y=Math.cos(F),V=Math.sin(F);let Z,J;if(c){const ot=X(B[b],-1,1),mt=X(A[b],-1,1);Z=z+(O+K*ot)*y-K*mt*V+H,J=U+(O+K*ot)*V+K*mt*y+D}else{const ot=O+K*X(B[b],-1,1);Z=z+ot*y+H,J=U+ot*V+D}const x=Math.round(Z),ct=Math.round(J);H=Z-x,D=J-ct,et[b]=`${x},${ct}`,G[b*2]=x/P,G[b*2+1]=ct/P}const at=Math.round((i+8)*P),nt=Math.max(12*P,Math.round((a-8)*P)),Y=Math.round(f/e),st=(f*10/1024/1024).toFixed(1),dt=C>1?`anti-alias → ${C.toFixed(1)}x decimate → soft-limit → RIAA@${rt}Hz → mu-law → err-diffuse`:`soft-limit → RIAA@${rt}Hz → mu-law → err-diffuse`,g=`Encoded ${h} samples → ${f} vertices [${dt}] (~${Y} pts/turn, ${e} turns, k=${W.toFixed(4)}, sr=${$}Hz, ~${st} MB)${c?" [STEREO M/S]":""}`,E=c?"; stereo=1":"";return{svg:`<svg xmlns="http://www.w3.org/2000/svg" width="520" height="520" viewBox="0 0 ${520*P} ${520*P}" role="img" aria-label="Geometry-only spiral record">
  <defs>
    <radialGradient id="discGrad" r="60%">
      <stop offset="0%" stop-color="#0e1217"/>
      <stop offset="100%" stop-color="#0b0f14"/>
    </radialGradient>
  </defs>
  <circle cx="${z}" cy="${U}" r="${at}" fill="url(#discGrad)" stroke="#233242" stroke-width="${2*P}"/>
  <circle cx="${z}" cy="${U}" r="${nt}" fill="#0a0d11" stroke="#22303b" stroke-width="${2*P}"/>
  <polyline id="audioGroove" fill="none" stroke="#5ad8cf" stroke-width="${.8*P}" stroke-linecap="round" points="${et.join(" ")}" />
  <desc>Geometry-only spiral audio. sr=${$}; Rout=${i}; Rin=${a}; turns=${e}; k=${W.toFixed(6)}; originalLength=${f}; mulaw=1; riaa=1; riaaHz=${rt}; scale=${P}${E}.</desc>
</svg>`,groovePoints:G,debugMsg:g}}function yt(u,t={}){const{cx:n=260,cy:o=260,Rout:e=220,Rin:l=40}=t,i=new DOMParser().parseFromString(u,"image/svg+xml"),a=i.querySelector("polyline#audioGroove");if(!a)throw new Error("No groove polyline found in SVG");let r=22050,s=0,d=0,c=!1,h=!1,v=!1,m=!1,f=1,C=lt;const $=i.querySelector("desc");if($){const g=$.textContent||"",E=g.match(/sr=(\d+)/);E&&(r=parseInt(E[1]));const k=g.match(/originalLength=(\d+)/);k&&(s=parseInt(k[1]));const b=g.match(/k=([\d.]+)/);b&&(d=parseFloat(b[1])),c=/mulaw=1/.test(g),h=/riaa=1/.test(g),v=!h&&/preemph=1/.test(g),m=/stereo=1/.test(g);const _=g.match(/scale=(\d+)/);_&&(f=parseInt(_[1]));const F=g.match(/riaaHz=(\d+)/);F&&(C=parseInt(F[1]))}let T=n,L=o;const w=i.querySelector("circle");w&&(T=(parseFloat(w.getAttribute("cx"))||n*f)/f,L=(parseFloat(w.getAttribute("cy"))||o*f)/f);const R=(a.getAttribute("points")||"").trim();if(!R)throw new Error("Empty points attribute in polyline");const M=R.split(/\s+/),S=new Array(M.length),B=new Float32Array(M.length*2);for(let g=0;g<M.length;g++){const[E,k]=M[g].split(",").map(Number);S[g]={x:E/f,y:k/f},B[g*2]=E/f,B[g*2+1]=k/f}const A=S.length,Q=i.querySelectorAll("circle");let q=e,W=l;if(Q.length>=2){const g=(parseFloat(Q[0].getAttribute("r"))||228*f)/f,E=(parseFloat(Q[1].getAttribute("r"))||32*f)/f;q=Math.max(30,g-8),W=Math.max(12,E+8)}let P=0,z=Math.atan2(S[0].y-L,S[0].x-T);for(let g=1;g<A;g++){const E=Math.atan2(S[g].y-L,S[g].x-T);let k=E-z;for(;k>Math.PI;)k-=p;for(;k<-Math.PI;)k+=p;P+=k,z=E}const U=Math.abs(P)/p,N=d>0?d:(()=>{const g=Math.min(2e3,Math.floor(A/10));let E=0,k=0;for(let _=0;_<g;_++){const F=_/(A-1),O=gt(F,q,W),y=S[_].x-T,V=S[_].y-L;E+=Math.abs(Math.hypot(y,V)-O),k++}const b=E/Math.max(1,k)||1;return Math.max(.5,b/.25)})(),tt=new Float32Array(A),K=m?new Float32Array(A):null;for(let g=0;g<A;g++){const E=S[g].x-T,k=S[g].y-L,b=g/(A-1),_=gt(b,q,W);if(m){const F=b*U*p,O=Math.cos(F),y=Math.sin(F),V=E*O+k*y,Z=-E*y+k*O,J=X((V-_)/N,-1,1),x=X(Z/N,-1,1);tt[g]=c?ht(J):J,K[g]=c?ht(x):x}else{const F=Math.hypot(E,k),O=X((F-_)/N,-1,1);tt[g]=c?ht(O):O}}const et=g=>h?Lt(g,r,C):v?Ct(g):g;let G=et(tt),H=m?et(K):null;if(s>0&&s!==A){const g=s/A;G=vt(G,s),g>1&&(G=ut(G,g)),H&&(H=vt(H,s),g>1&&(H=ut(H,g)))}if(m){let g=0;for(let y=0;y<G.length;y++)g+=G[y];const E=g/G.length;if(Math.abs(E)>.001)for(let y=0;y<G.length;y++)G[y]-=E;const k=new Float32Array(G.length),b=new Float32Array(G.length);for(let y=0;y<G.length;y++)k[y]=G[y]+H[y],b[y]=G[y]-H[y];let _=0;for(let y=0;y<k.length;y++)_=Math.max(_,Math.abs(k[y]),Math.abs(b[y]));if(_>.001&&_<.99){const y=1/_;for(let V=0;V<k.length;V++)k[V]*=y,b[V]*=y}const F=Math.min(256,Math.floor(k.length*ft)),O=Math.max(1,F-1);for(let y=0;y<F;y++){const V=y/O;k[y]*=V,k[k.length-1-y]*=V,b[y]*=V,b[b.length-1-y]*=V}return{samples:k,samplesL:k,samplesR:b,sampleRate:r,turns:U,vertices:A,Rout:q,Rin:W,cx:T,cy:L,k:N,groovePoints:B}}let D=G,at=0;for(let g=0;g<D.length;g++)at+=D[g];const nt=at/D.length;if(Math.abs(nt)>.001)for(let g=0;g<D.length;g++)D[g]-=nt;let Y=0;for(let g=0;g<D.length;g++){const E=Math.abs(D[g]);E>Y&&(Y=E)}if(Y>.001&&Y<.99){const g=1/Y;for(let E=0;E<D.length;E++)D[E]*=g}const st=Math.min(256,Math.floor(D.length*ft)),dt=Math.max(1,st-1);for(let g=0;g<st;g++){const E=g/dt;D[g]*=E,D[D.length-1-g]*=E}return{samples:D,sampleRate:r,turns:U,vertices:A,Rout:q,Rin:W,cx:T,cy:L,k:N,groovePoints:B}}const Dt={"--bg-grad-1":"#0f0f0f","--bg-grad-2":"#1a1a1a","--panel-bg":"rgba(255,255,255,0.05)","--panel-border":"rgba(255,255,255,0.1)","--accent":"#4ecdc4","--accent-alt":"#44a08d","--accent-glow":"rgba(78,205,196,0.4)","--accent-subtle":"rgba(78,205,196,0.1)","--accent-subtle-drag":"rgba(78,205,196,0.2)","--text":"#ffffff","--text-muted":"#888888","--text-secondary":"#dddddd","--font-ui":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","--font-mono":"'Courier New', monospace","--debug-bg":"rgba(0,0,0,0.8)","--debug-border":"#333333","--upload-audio":"#4ecdc4","--upload-svg":"#da70d6","--upload-svg-bg":"rgba(218,112,214,0.05)","--status-success":"#4ecdc4","--status-error":"#ff4444","--status-info":"#ffc107","--section-border-left":"#4ecdc4"},Ot={disc:{bg:["#151920","#0e1217","#0b0f14"],rim:"#1e2d3d",outerRim:"rgba(100,160,220,0.12)",rings:["rgba(90,216,207,0.025)","rgba(100,140,200,0.018)"]},label:{bg:["#2a1a3a","#1e1030","#150a22"],border:"#4a3060",innerRing:"rgba(120,80,180,0.25)",text:"rgba(200,170,255,0.55)",textEmpty:"rgba(255,255,255,0.2)"},groove:{base:"rgba(90,216,207,0.35)",glow:"#5ad8cf",glowCore:"rgba(90,216,207,0.18)",hueShift:150,hueMult:.75},activeRing:{outer:"rgba(90,216,207,0.22)",inner:"rgba(160,240,235,0.12)",glow:"#5ad8cf"},stylus:{bloom:"#ff2200",bloomFill:[255,30,0],midG:60,core:"#ff4422",coreGlow:"#ff8866",beamRGB:[255,50,20]}},Vt={"--bg-grad-1":"#080b0f","--bg-grad-2":"#0d1117","--panel-bg":"rgba(255,255,255,0.03)","--panel-border":"rgba(0,229,255,0.12)","--accent":"#00e5ff","--accent-alt":"#00b8d4","--accent-glow":"rgba(0,229,255,0.4)","--accent-subtle":"rgba(0,229,255,0.1)","--accent-subtle-drag":"rgba(0,229,255,0.2)","--text":"#e0f7fa","--text-muted":"#607d8b","--text-secondary":"#b0bec5","--font-ui":"'Orbitron', 'Segoe UI', sans-serif","--font-mono":"'Courier New', monospace","--debug-bg":"rgba(0,0,0,0.8)","--debug-border":"#1a2a3a","--upload-audio":"#00e5ff","--upload-svg":"#ff00aa","--upload-svg-bg":"rgba(255,0,170,0.05)","--status-success":"#00e5ff","--status-error":"#ff4444","--status-info":"#ffc107","--section-border-left":"#00e5ff"},Wt={disc:{bg:["#0d1a26","#091018","#060c14"],rim:"#0e2235",outerRim:"rgba(0,229,255,0.1)",rings:["rgba(0,229,255,0.025)","rgba(0,100,200,0.018)"]},label:{bg:["#0a1828","#060f1e","#040b16"],border:"#0e2840",innerRing:"rgba(0,150,220,0.25)",text:"rgba(0,229,255,0.65)",textEmpty:"rgba(0,229,255,0.2)"},groove:{base:"rgba(0,229,255,0.35)",glow:"#00e5ff",glowCore:"rgba(0,229,255,0.18)",hueShift:180,hueMult:.6},activeRing:{outer:"rgba(0,229,255,0.22)",inner:"rgba(0,200,255,0.12)",glow:"#00e5ff"},stylus:{bloom:"#ff00aa",bloomFill:[255,0,170],midG:0,core:"#ff00aa",coreGlow:"#ff66cc",beamRGB:[255,0,170]}},Ut={"--bg-grad-1":"#0a0e14","--bg-grad-2":"#131b24","--panel-bg":"rgba(20,30,42,0.85)","--panel-border":"rgba(80,120,150,0.25)","--accent":"#00c8e8","--accent-alt":"#0090b0","--accent-glow":"rgba(0,200,232,0.4)","--accent-subtle":"rgba(0,200,232,0.08)","--accent-subtle-drag":"rgba(0,200,232,0.16)","--text":"#c8dde8","--text-muted":"#4a6070","--text-secondary":"#8aa0b0","--font-ui":"'Orbitron', 'Segoe UI', sans-serif","--font-mono":"'Courier New', monospace","--debug-bg":"rgba(4,10,18,0.95)","--debug-border":"#1a2a3a","--upload-audio":"#00c8e8","--upload-svg":"#ffa040","--upload-svg-bg":"rgba(255,160,64,0.04)","--status-success":"#00c8e8","--status-error":"#ff4444","--status-info":"#ffa040","--section-border-left":"#00c8e8"},Nt={disc:{bg:["#060e18","#040b12","#02080f"],rim:"#0e2035",outerRim:"rgba(0,180,220,0.12)",rings:["rgba(0,200,232,0.03)","rgba(0,100,160,0.02)"]},label:{bg:["#081525","#041018","#020c14"],border:"#0c2040",innerRing:"rgba(0,200,232,0.3)",text:"rgba(0,200,232,0.75)",textEmpty:"rgba(0,200,232,0.25)"},groove:{base:"rgba(0,200,232,0.3)",glow:"#00c8e8",glowCore:"rgba(0,200,232,0.15)",hueShift:190,hueMult:.45},activeRing:{outer:"rgba(0,200,232,0.22)",inner:"rgba(0,160,200,0.12)",glow:"#00c8e8"},stylus:{bloom:"#0055ff",bloomFill:[0,80,255],midG:80,core:"#4499ff",coreGlow:"#80c4ff",beamRGB:[0,80,255]}},qt={"--bg-grad-1":"#0a0805","--bg-grad-2":"#110e07","--panel-bg":"rgba(212,136,10,0.03)","--panel-border":"rgba(180,110,15,0.18)","--accent":"#d4880a","--accent-alt":"#9a6208","--accent-glow":"rgba(212,136,10,0.42)","--accent-subtle":"rgba(212,136,10,0.1)","--accent-subtle-drag":"rgba(212,136,10,0.2)","--text":"#f0dbb0","--text-muted":"#6a5030","--text-secondary":"#c0a060","--font-ui":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","--font-mono":"'Courier New', monospace","--debug-bg":"rgba(5,3,1,0.92)","--debug-border":"#2a1a08","--upload-audio":"#d4880a","--upload-svg":"#cc6633","--upload-svg-bg":"rgba(204,102,51,0.05)","--status-success":"#d4880a","--status-error":"#ff4444","--status-info":"#ffc107","--section-border-left":"#d4880a"},zt={theme:"owl",disc:{bg:["#100c06","#0a0805","#070502"],rim:"#2a1c08",outerRim:"rgba(160,95,12,0.16)",rings:["rgba(170,95,8,0.048)","rgba(130,70,4,0.030)"]},label:{bg:["#3a1e00","#200e00","#120800"],border:"#b06c10",innerRing:"rgba(210,150,28,0.45)",text:"rgba(255,200,80,0.75)",textEmpty:"rgba(255,200,80,0.25)",labelText:"OWL"},groove:{base:"rgba(180,100,15,0.35)",glow:"#c8820e",glowCore:"rgba(200,130,20,0.18)",hueShift:35,hueMult:.38},activeRing:{outer:"rgba(200,140,20,0.28)",inner:"rgba(240,180,40,0.14)",glow:"#c8820e"},stylus:{bloom:"#ff6600",bloomFill:[255,100,0],midG:40,core:"#ffaa00",coreGlow:"#ffd060",beamRGB:[255,120,0]}},Ht={"--bg-grad-1":"#020804","--bg-grad-2":"#041006","--panel-bg":"rgba(0,220,80,0.03)","--panel-border":"rgba(0,180,70,0.18)","--accent":"#00e060","--accent-alt":"#009040","--accent-glow":"rgba(0,220,80,0.42)","--accent-subtle":"rgba(0,220,80,0.1)","--accent-subtle-drag":"rgba(0,220,80,0.2)","--text":"#a0ffcc","--text-muted":"#2a5038","--text-secondary":"#60b080","--font-ui":"'Courier New', monospace","--font-mono":"'Courier New', monospace","--debug-bg":"rgba(0,4,2,0.92)","--debug-border":"#082014","--upload-audio":"#00e060","--upload-svg":"#00aaff","--upload-svg-bg":"rgba(0,170,255,0.05)","--status-success":"#00e060","--status-error":"#ff4444","--status-info":"#00aaff","--section-border-left":"#00e060"},jt={theme:"eq",disc:{bg:["#020e06","#010904","#010603"],rim:"#032812",outerRim:"rgba(0,200,80,0.10)",rings:["rgba(0,200,80,0.032)","rgba(0,150,60,0.020)"]},label:{bg:["#041a0a","#020e06","#010a04"],border:"#044020",innerRing:"rgba(0,220,80,0.3)",text:"rgba(0,230,90,0.85)",textEmpty:"rgba(0,230,90,0.28)",labelText:"EQ"},groove:{base:"rgba(0,200,80,0.32)",glow:"#00e060",glowCore:"rgba(0,230,90,0.16)",hueShift:120,hueMult:.18},activeRing:{outer:"rgba(0,220,80,0.26)",inner:"rgba(0,255,100,0.12)",glow:"#00e060"},stylus:{bloom:"#0088ff",bloomFill:[0,136,255],midG:136,core:"#44aaff",coreGlow:"#88ccff",beamRGB:[0,100,255]}},I={classic:{name:"Classic",fontUrl:null,css:Dt,canvas:Ot},vagc77:{name:"VAGC-77",fontUrl:"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&display=swap",css:Vt,canvas:Wt},omitron:{name:"OMITRON",fontUrl:"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&display=swap",css:Ut,canvas:Nt},owl:{name:"OWL",fontUrl:null,css:qt,canvas:zt},eq:{name:"EQ",fontUrl:null,css:Ht,canvas:jt}};class Qt{constructor(){this._current=null,this._fontLinkEl=null}get current(){return this._current}apply(t){const n=document.documentElement;for(const[o,e]of Object.entries(t.css))n.style.setProperty(o,e);this._applyFont(t.fontUrl),this._current=t,this._persist(t)}load(t){const n=JSON.parse(t),o=this._mergeWithBase(n);return this.apply(o),localStorage.setItem("vagc-skin-name","custom"),o}export(){return JSON.stringify(this._current,null,2)}restore(){const t=localStorage.getItem("vagc-skin-name");if(!t)return null;if(t==="classic")return this.apply(I.classic),I.classic;if(t==="vagc77")return this.apply(I.vagc77),I.vagc77;if(t==="omitron")return this.apply(I.omitron),I.omitron;if(t==="owl")return this.apply(I.owl),I.owl;if(t==="eq")return this.apply(I.eq),I.eq;if(t==="custom"){const n=localStorage.getItem("vagc-skin-custom");if(n)try{const o=this._mergeWithBase(JSON.parse(n));return this.apply(o),o}catch{return null}}return null}_applyFont(t){if(this._fontLinkEl&&(this._fontLinkEl.remove(),this._fontLinkEl=null),t){const n=document.createElement("link");n.rel="stylesheet",n.href=t,document.head.appendChild(n),this._fontLinkEl=n}}_persist(t){t===I.classic?localStorage.setItem("vagc-skin-name","classic"):t===I.vagc77?localStorage.setItem("vagc-skin-name","vagc77"):t===I.omitron?localStorage.setItem("vagc-skin-name","omitron"):t===I.owl?localStorage.setItem("vagc-skin-name","owl"):t===I.eq?localStorage.setItem("vagc-skin-name","eq"):(localStorage.setItem("vagc-skin-name","custom"),localStorage.setItem("vagc-skin-custom",JSON.stringify(t)))}_mergeWithBase(t){var o,e,l,i,a;const n=I.classic;return{name:t.name||n.name,fontUrl:t.fontUrl!==void 0?t.fontUrl:n.fontUrl,css:{...n.css,...t.css||{}},canvas:{disc:{...n.canvas.disc,...((o=t.canvas)==null?void 0:o.disc)||{}},label:{...n.canvas.label,...((e=t.canvas)==null?void 0:e.label)||{}},groove:{...n.canvas.groove,...((l=t.canvas)==null?void 0:l.groove)||{}},activeRing:{...n.canvas.activeRing,...((i=t.canvas)==null?void 0:i.activeRing)||{}},stylus:{...n.canvas.stylus,...((a=t.canvas)==null?void 0:a.stylus)||{}}}}}}class Kt{constructor(t){this.canvas=t,this.grooveImage=null,this.skin=I.classic.canvas,this._groovePoints=null,this._grooveGeom={}}setSkin(t,n=null,o={}){this.skin=t,n&&(this._groovePoints=n,this._grooveGeom=o,this.preRenderGroove(n,o))}drawEmptyDisc({Rout:t=220,Rin:n=40,cx:o=260,cy:e=260}={}){const{canvas:l}=this,i=l.getContext("2d"),a=l.width,r=a/520,s=o*r,d=e*r,c=(t+8)*r,h=Math.max(12,n-8)*r,v=45*r;i.clearRect(0,0,a,a),this._drawDiscBody(i,a,r,s,d,c,h),this._drawLabel(i,r,s,d,v,!1),this._drawSheen(i,a,s,d,c,r)}preRenderGroove(t,{cx:n=260,cy:o=260}={}){const{canvas:e}=this,l=e.width,i=l/520,a=t,r=a.length/2;if(r===0)return;const s=document.createElement("canvas");s.width=l,s.height=l;const d=s.getContext("2d"),c=this.skin.groove,h=Math.max(1,Math.floor(r/2e5));d.lineWidth=.55*i,d.lineCap="round",d.lineJoin="round",d.strokeStyle=c.base,d.beginPath(),d.moveTo(a[0]*i,a[1]*i);for(let m=h;m<r;m+=h)d.lineTo(a[m*2]*i,a[m*2+1]*i);d.stroke();const v=Math.max(h*2,Math.floor(r/1500));d.lineWidth=1*i,d.lineCap="round",d.lineJoin="round";for(let m=0;m<r-1;m+=v){const f=Math.min(m+Math.floor(v/2),r-1),C=a[f*2]-n,$=a[f*2+1]-o,w=((Math.atan2($,C)/p*360+360)%360*c.hueMult+c.hueShift)%360,R=Math.min(m+v+1,r);d.beginPath(),d.moveTo(a[m*2]*i,a[m*2+1]*i);for(let M=m+h;M<R;M+=h)d.lineTo(a[M*2]*i,a[M*2+1]*i);d.strokeStyle=`hsla(${w}, 85%, 68%, 0.28)`,d.stroke()}d.shadowColor=c.glow,d.shadowBlur=4*i,d.lineWidth=.3*i,d.strokeStyle=c.glowCore,d.beginPath(),d.moveTo(a[0]*i,a[1]*i);for(let m=h;m<r;m+=h)d.lineTo(a[m*2]*i,a[m*2+1]*i);d.stroke(),d.shadowBlur=0,this.grooveImage=s}drawDiscWithGroove(t,n,{Rout:o=220,Rin:e=40,cx:l=260,cy:i=260}={},a=0){const{canvas:r}=this,s=r.getContext("2d"),d=r.width,c=d/520,h=l*c,v=i*c,m=(o+8)*c,f=Math.max(12,e-8)*c,C=45*c;s.clearRect(0,0,d,d),s.save(),s.translate(h,v),s.rotate(t),s.translate(-h,-v),this._drawDiscBody(s,d,c,h,v,m,f),this.grooveImage&&s.drawImage(this.grooveImage,0,0);const $=h+m*.28,T=v-m*.42,L=s.createRadialGradient($,T,0,$,T,m*.75);if(L.addColorStop(0,"rgba(255,255,255,0.055)"),L.addColorStop(.45,"rgba(255,255,255,0.018)"),L.addColorStop(1,"rgba(255,255,255,0)"),s.save(),s.beginPath(),s.arc(h,v,m-c,0,p),s.clip(),s.fillStyle=L,s.fillRect(h-m,v-m,m*2,m*2),s.restore(),this._drawLabel(s,c,h,v,C,!0),s.restore(),n>=0&&n<=1){const R=(o-n*(o-e))*c,M=this.skin.activeRing;s.save(),s.shadowColor=M.glow,s.shadowBlur=18*c,s.beginPath(),s.arc(h,v,R,0,p),s.strokeStyle=M.outer,s.lineWidth=2.5*c,s.stroke(),s.shadowBlur=8*c,s.beginPath(),s.arc(h,v,R,0,p),s.strokeStyle=M.inner,s.lineWidth=1*c,s.stroke(),s.shadowBlur=0,s.restore()}if(this._drawSheen(s,d,h,v,m,c),n>=0&&n<=1){const w=n,R=-Math.PI*.25,M=(o-w*(o-e))*c,S=h+M*Math.cos(R),B=v+M*Math.sin(R),A=this.skin.stylus,Q=1+a*5;s.save(),s.shadowColor=A.bloom,s.shadowBlur=(35+a*80)*c,s.beginPath(),s.arc(S,B,6*Q*c,0,p),s.fillStyle=`rgba(${A.bloomFill[0]},${A.bloomFill[1]},${A.bloomFill[2]},${.25+a*.25})`,s.fill(),s.shadowBlur=(20+a*40)*c,s.beginPath(),s.arc(S,B,4*Q*c,0,p),s.fillStyle=`rgba(${A.bloomFill[0]},${A.midG+(a*80|0)},${A.bloomFill[2]},${.6+a*.3})`,s.fill(),s.shadowColor=A.coreGlow,s.shadowBlur=(8+a*20)*c,s.beginPath(),s.arc(S,B,2.5*Math.max(1,Q*.7)*c,0,p),s.fillStyle=A.core,s.fill(),s.shadowBlur=0,s.beginPath(),s.arc(S,B,1.2*c,0,p),s.fillStyle="#fff",s.fill();const q=(25+a*40)*c,W=(2.5+a*4)*c,[P,z,U]=A.beamRGB,N=s.createLinearGradient(S,B,S,B-q);N.addColorStop(0,`rgba(${P},${z},${U},${.5+a*.4})`),N.addColorStop(.3,`rgba(${P},${z},${U},${.1+a*.2})`),N.addColorStop(1,`rgba(${P},${z},${U},0)`),s.fillStyle=N,s.beginPath(),s.moveTo(S-W,B),s.lineTo(S-W*.3,B-q),s.lineTo(S+W*.3,B-q),s.lineTo(S+W,B),s.closePath(),s.fill(),s.restore()}}_drawDiscBody(t,n,o,e,l,i,a){const r=this.skin.disc,s=t.createRadialGradient(e,l,a,e,l,i);s.addColorStop(0,r.bg[0]),s.addColorStop(.5,r.bg[1]),s.addColorStop(1,r.bg[2]),t.beginPath(),t.arc(e,l,i,0,p),t.fillStyle=s,t.fill(),t.strokeStyle=r.rim,t.lineWidth=3*o,t.stroke();for(let d=0;d<10;d++){const c=a+(i-a)*(d/10);t.beginPath(),t.arc(e,l,c,0,p),t.strokeStyle=d%2===0?r.rings[0]:r.rings[1],t.lineWidth=.4*o,t.stroke()}t.beginPath(),t.arc(e,l,i-o,0,p),t.strokeStyle=r.outerRim,t.lineWidth=1.5*o,t.stroke(),this.skin.theme==="eq"&&this._drawEqBars(t,o,e,l,i,a)}_drawLabel(t,n,o,e,l,i){if(this.skin.theme==="owl"){this._drawOwlEye(t,n,o,e,l);return}const a=this.skin.label,r=getComputedStyle(document.documentElement).getPropertyValue("--font-ui").trim(),s=t.createRadialGradient(o,e,0,o,e,l);s.addColorStop(0,a.bg[0]),s.addColorStop(.7,a.bg[1]),s.addColorStop(1,a.bg[2]),t.beginPath(),t.arc(o,e,l,0,p),t.fillStyle=s,t.fill(),t.strokeStyle=a.border,t.lineWidth=1.5*n,t.stroke(),t.beginPath(),t.arc(o,e,l*.6,0,p),t.strokeStyle=a.innerRing,t.lineWidth=.8*n,t.stroke();const d=a.labelText||"SPIRAL";t.font=`bold ${9*n}px ${r}`,t.fillStyle=i?a.text:a.textEmpty,t.textAlign="center",t.textBaseline="middle",t.fillText(i?d:"DROP AUDIO",o,e-4*n),i||(t.font=`${7*n}px ${r}`,t.fillStyle=a.textEmpty,t.fillText("TO GENERATE",o,e+7*n)),t.beginPath(),t.arc(o,e,4*n,0,p),t.fillStyle="#111",t.fill(),t.strokeStyle="#333",t.lineWidth=.8*n,t.stroke()}_drawOwlEye(t,n,o,e,l){const i=90*n,a=i*.88,r=i*.42;t.save(),t.beginPath(),t.arc(o,e,i*1.05,0,p),t.clip();const s=t.createRadialGradient(o,e,a,o,e,i*1.05);s.addColorStop(0,"rgba(0,0,0,0)"),s.addColorStop(.5,"rgba(6,3,1,0.55)"),s.addColorStop(1,"rgba(4,2,0,0.92)"),t.fillStyle=s,t.fillRect(o-i*1.1,e-i*1.1,i*2.2,i*2.2),t.restore();const d=t.createRadialGradient(o,e,a*.96,o,e,a*1.1);d.addColorStop(0,"rgba(200,170,110,0.0)"),d.addColorStop(.6,"rgba(160,130,80,0.22)"),d.addColorStop(1,"rgba(100,75,40,0.10)"),t.beginPath(),t.arc(o,e,a*1.1,0,p),t.fillStyle=d,t.fill();const c=t.createRadialGradient(o,e,0,o,e,a);c.addColorStop(0,"#1c0900"),c.addColorStop(.22,"#4e1c00"),c.addColorStop(.48,"#904c08"),c.addColorStop(.7,"#c07010"),c.addColorStop(.88,"#d88c1a"),c.addColorStop(1,"#e89c20"),t.beginPath(),t.arc(o,e,a,0,p),t.fillStyle=c,t.fill(),t.save(),t.beginPath(),t.arc(o,e,a,0,p),t.clip();for(let w=0;w<120;w++){const R=w/120*p,M=r*1.08,S=a*(.82+(Math.sin(w*5.73)*.5+.5)*.18),B=.06+(Math.sin(w*3.73+1.1)*.5+.5)*.13,A=(.35+(Math.sin(w*7.31)*.5+.5)*.65)*n;t.beginPath(),t.moveTo(o+M*Math.cos(R),e+M*Math.sin(R)),t.lineTo(o+S*Math.cos(R),e+S*Math.sin(R)),t.strokeStyle=`rgba(255,215,95,${B})`,t.lineWidth=A,t.stroke()}for(let w=0;w<80;w++){const R=w/80*p+p/160,M=r*1.04,S=.04+(Math.cos(w*4.91+.7)*.5+.5)*.09;t.beginPath(),t.moveTo(o+M*Math.cos(R),e+M*Math.sin(R)),t.lineTo(o+a*.95*Math.cos(R),e+a*.95*Math.sin(R)),t.strokeStyle=`rgba(200,155,55,${S})`,t.lineWidth=.28*n,t.stroke()}for(let w=0;w<20;w++){const R=w/20*p+w*.31,M=r*1.25+(a-r*1.25)*(.15+(Math.sin(w*2.7)*.5+.5)*.65),S=(2.5+(Math.sin(w*5.1)*.5+.5)*6)*n,B=.14+(Math.sin(w*3.3)*.5+.5)*.22;t.beginPath(),t.ellipse(o+M*Math.cos(R),e+M*Math.sin(R),S,S*.65,R,0,p),t.fillStyle=`rgba(8,3,0,${B})`,t.fill()}for(let w=0;w<40;w++){const R=w/40*p,M=r*(1.12+(Math.sin(w*7+2)*.5+.5)*.14);t.beginPath(),t.arc(o+M*Math.cos(R),e+M*Math.sin(R),2.2*n,0,p),t.fillStyle=`rgba(25,10,0,${.28+(Math.sin(w*3.7)*.5+.5)*.28})`,t.fill()}t.beginPath(),t.arc(o,e,a,0,p);const h=t.createRadialGradient(o,e,a*.76,o,e,a);h.addColorStop(0,"rgba(0,0,0,0)"),h.addColorStop(1,"rgba(0,0,0,0.84)"),t.fillStyle=h,t.fill(),t.restore(),t.beginPath(),t.arc(o,e,a,0,p),t.strokeStyle="rgba(170,110,18,0.65)",t.lineWidth=1.8*n,t.stroke();const v=t.createRadialGradient(o,e,0,o,e,r);v.addColorStop(0,"#140800"),v.addColorStop(.55,"#080300"),v.addColorStop(1,"#000000"),t.beginPath(),t.arc(o,e,r,0,p),t.fillStyle=v,t.fill(),t.beginPath(),t.arc(o,e,r,0,p),t.strokeStyle="rgba(130,70,10,0.55)",t.lineWidth=1.4*n,t.stroke();const m=o-r*.38,f=e-r*.5,C=t.createRadialGradient(m,f,0,m,f,r*.44);C.addColorStop(0,"rgba(255,255,255,0.80)"),C.addColorStop(.4,"rgba(255,248,225,0.24)"),C.addColorStop(1,"rgba(255,255,255,0)"),t.beginPath(),t.arc(m,f,r*.44,0,p),t.fillStyle=C,t.fill();const $=o+r*.38,T=e+r*.4,L=t.createRadialGradient($,T,0,$,T,r*.16);L.addColorStop(0,"rgba(255,255,255,0.35)"),L.addColorStop(1,"rgba(255,255,255,0)"),t.beginPath(),t.arc($,T,r*.16,0,p),t.fillStyle=L,t.fill(),t.beginPath(),t.arc(o,e,4*n,0,p),t.fillStyle="#000",t.fill()}_drawEqBars(t,n,o,e,l,i){const s=p/24,d=l-i,c=Array.from({length:24},(h,v)=>{const m=v/24;return Math.max(.06,Math.min(.92,Math.abs(Math.sin(m*Math.PI*4.1)*.45+Math.sin(m*Math.PI*9.3+1.2)*.3+Math.cos(m*Math.PI*2.7+.5)*.25)))});t.save();for(let h=0;h<24;h++){const v=h*s+.035,m=(h+1)*s-.07/2,f=c[h],C=i+d*f;t.beginPath(),t.arc(o,e,C,v,m),t.arc(o,e,i,m,v,!0),t.closePath(),t.shadowColor=`rgba(0,255,90,${.5+f*.3})`,t.shadowBlur=20*n,t.fillStyle=`rgba(0,200,70,${.08+f*.12})`,t.fill()}t.shadowBlur=0;for(let h=0;h<24;h++){const v=h*s+.035,m=(h+1)*s-.07/2,f=c[h],C=i+d*f;t.beginPath(),t.arc(o,e,C,v,m),t.arc(o,e,i,m,v,!0),t.closePath();const $=t.createRadialGradient(o,e,i,o,e,C);$.addColorStop(0,"rgba(0,200,80,0.0)"),$.addColorStop(.5,`rgba(0,220,85,${.12+f*.16})`),$.addColorStop(1,`rgba(0,255,100,${.22+f*.26})`),t.fillStyle=$,t.fill()}for(let h=0;h<24;h++){const v=h*s+.035,m=(h+1)*s-.07/2,f=c[h],C=i+d*f;t.beginPath(),t.arc(o,e,C,v,m),t.strokeStyle=`rgba(140,255,170,${.6+f*.38})`,t.lineWidth=2*n,t.shadowColor="rgba(0,255,100,1.0)",t.shadowBlur=14*n,t.stroke()}t.shadowBlur=0,t.restore()}_drawSheen(t,n,o,e,l,i){const a=t.createRadialGradient(o-l*.22,e-l*.38,0,o-l*.22,e-l*.38,l*.95);a.addColorStop(0,"rgba(255,255,255,0.038)"),a.addColorStop(.5,"rgba(255,255,255,0.010)"),a.addColorStop(1,"rgba(255,255,255,0)"),t.save(),t.beginPath(),t.arc(o,e,l-i,0,p),t.clip(),t.fillStyle=a,t.fillRect(0,0,n,n),t.restore()}}class Yt{constructor({onFrame:t,onStop:n,onDebug:o}){this.onFrame=t,this.onStop=n,this.onDebug=o,this.isPlaying=!1,this.animationId=null,this._ctx=null,this._node=null,this._latestProgress=0,this._amplitude=0,this._totalDuration=0,this._baseAdv=1}async start(t,n,o=0){this.stop(),this.isPlaying=!0;let e=t.left||t.samples,l=t.right||null,i=t.sampleRate;i<j&&(this.onDebug(`Upsampling ${i}Hz → ${j}Hz`),e=this._resample(e,i,j),l&&(l=this._resample(l,i,j)),i=j);try{const a=new(window.AudioContext||window.webkitAudioContext);a.state==="suspended"&&await a.resume(),await a.audioWorklet.addModule("/groove-processor.js"),this._ctx=a,this._totalDuration=e.length/i,this._baseAdv=i/a.sampleRate,this._latestProgress=o;const r=l!==null;this._node=new AudioWorkletNode(a,"groove-processor",{outputChannelCount:[r?2:1]}),this._node.connect(a.destination),this._node.port.onmessage=({data:h})=>{if(h.type==="pos"){this._latestProgress=h.v;const v=h.amp||0;v>this._amplitude?this._amplitude=.6*v+.4*this._amplitude:this._amplitude=.04*v+.96*this._amplitude}else h.type==="ended"&&this.stop()};const s=e.buffer.slice(0),d=l?l.buffer.slice(0):null,c=d?[s,d]:[s];this._node.port.postMessage({type:"load",left:s,right:d,startPos:Math.round(o*e.length),adv:this._baseAdv*n},c),this._animate(),this.onDebug(`Scratch playback ready: ${n}x, ${this._totalDuration.toFixed(2)}s, adv=${this._baseAdv.toFixed(4)}${r?" [stereo]":""}`)}catch(a){this.isPlaying=!1,this.onDebug(`Playback error: ${a.message}`),console.error(a)}}setRate(t){this._node&&this._node.port.postMessage({type:"adv",adv:this._baseAdv*t})}stop(){this.isPlaying=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this._node&&(this._node.disconnect(),this._node=null),this._ctx&&(this._ctx.close().catch(()=>{}),this._ctx=null),this.onStop()}get latestProgress(){return this._latestProgress}createWAVBlob(t){let n=t.left||t.samples,o=t.right||null,e=t.sampleRate;e<j&&(n=this._resample(n,e,j),o&&(o=this._resample(o,e,j)),e=j);const l=o?2:1,i=n.length,a=new ArrayBuffer(44+i*l*2),r=new DataView(a),s=(d,c)=>{for(let h=0;h<c.length;h++)r.setUint8(d+h,c.charCodeAt(h))};s(0,"RIFF"),r.setUint32(4,36+i*l*2,!0),s(8,"WAVE"),s(12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,l,!0),r.setUint32(24,e,!0),r.setUint32(28,e*l*2,!0),r.setUint16(32,l*2,!0),r.setUint16(34,16,!0),s(36,"data"),r.setUint32(40,i*l*2,!0);for(let d=0;d<i;d++)r.setInt16(44+d*l*2,Math.max(-1,Math.min(1,n[d]))*32767,!0),o&&r.setInt16(44+d*l*2+2,Math.max(-1,Math.min(1,o[d]))*32767,!0);return new Blob([a],{type:"audio/wav"})}_resample(t,n,o){if(n===o)return t;const e=n/o,l=Math.round(t.length/e),i=new Float32Array(l),a=t.length;for(let r=0;r<l;r++){const s=r*e,d=Math.floor(s),c=s-d;i[r]=$t(t[Math.max(0,d-1)],t[d],t[Math.min(a-1,d+1)],t[Math.min(a-1,d+2)],c)}return i}_animate(){const t=n=>{this.isPlaying&&(this.onFrame({progress:this._latestProgress,audioTimePosition:this._latestProgress*this._totalDuration,amplitude:this._amplitude}),this.animationId=requestAnimationFrame(t))};this.animationId=requestAnimationFrame(t)}}class Jt{constructor(){this.originalAudio=null,this.originalAudioR=null,this.decodedAudio=null,this.decodedAudioR=null,this.sampleRate=44100,this.duration=0,this.grooveSVG=null,this.groovePoints=null,this.Rout=Rt,this.Rin=kt,this.cx=At,this.cy=It,this.spiralTurns=30,this.scrubProgress=0,this.discRotation=0,this.isDragging=!1,this._spinRate=0,this._spindownId=null,this.dragLastAngle=0,this.dragLastTime=0,this.scratchVel=0,this._lastFrameTime=performance.now(),this.skinManager=new Qt,this.renderer=new Kt(document.getElementById("grooveCanvas")),this.playback=new Yt({onFrame:({progress:o,audioTimePosition:e,amplitude:l=0})=>{if(!this.isDragging){const i=performance.now(),a=(i-this._lastFrameTime)/1e3;this._lastFrameTime=i,this._spinRate=Math.min(1,this._spinRate+1.5*a),this.discRotation+=a*bt*this._spinRate}this.scrubProgress=o,this.renderer.drawDiscWithGroove(this.discRotation,this.scrubProgress,this._geom(),l),document.getElementById("currentTime").textContent=this._formatTime(e)},onStop:()=>{var o;document.getElementById("playBtn").style.display="inline-block",document.getElementById("pauseBtn").style.display="none",document.getElementById("currentTime").textContent=this._formatTime(this.scrubProgress*this.duration),(o=document.getElementById("playWrap"))==null||o.classList.remove("playing"),this._startSpindown(),this.debug("Playback stopped")},onDebug:o=>this.debug(o)}),this._bindUI();const t=this.skinManager.restore(),n=t||I.owl;t||this.skinManager.apply(n),this.renderer.setSkin(n.canvas),this._updateSkinButtons(n),this.renderer.drawEmptyDisc(this._geom())}_geom(){return{Rout:this.Rout,Rin:this.Rin,cx:this.cx,cy:this.cy}}_bindUI(){var i;const t=document.getElementById("uploadArea"),n=document.getElementById("audioFile");t.addEventListener("click",()=>n.click()),t.addEventListener("dragover",a=>{a.preventDefault(),t.classList.add("dragover")}),t.addEventListener("dragleave",a=>{t.contains(a.relatedTarget)||t.classList.remove("dragover")}),t.addEventListener("drop",a=>{a.preventDefault(),t.classList.remove("dragover");const r=a.dataTransfer.files[0];r!=null&&r.type.startsWith("audio/")?this.loadAudioFile(r):r&&(r.type==="image/svg+xml"||r.name.endsWith(".svg"))?this.loadGrooveFile(r):this._statusError("Please drop an audio file or SVG groove file")}),n.addEventListener("change",a=>{a.target.files[0]&&this.loadAudioFile(a.target.files[0])});const o=document.getElementById("svgUploadArea"),e=document.getElementById("svgFile");o.addEventListener("click",()=>e.click()),o.addEventListener("dragover",a=>{a.preventDefault(),o.classList.add("dragover")}),o.addEventListener("dragleave",()=>o.classList.remove("dragover")),o.addEventListener("drop",a=>{a.preventDefault(),o.classList.remove("dragover");const r=a.dataTransfer.files[0];r&&(r.type==="image/svg+xml"||r.name.endsWith(".svg"))?this.loadGrooveFile(r):r!=null&&r.type.startsWith("audio/")?this.loadAudioFile(r):this._statusError("Please drop an SVG groove file or audio file")}),e.addEventListener("change",a=>{a.target.files[0]&&this.loadGrooveFile(a.target.files[0])}),(i=document.getElementById("loadSvgBtn"))==null||i.addEventListener("click",()=>document.getElementById("svgFile").click()),document.getElementById("generateGroove").addEventListener("click",()=>this.generateGroove()),document.getElementById("playBtn").addEventListener("click",()=>this.startPlayback()),document.getElementById("pauseBtn").addEventListener("click",()=>this.playback.stop()),document.getElementById("downloadSVG").addEventListener("click",()=>this.downloadSVG()),document.getElementById("downloadAudio").addEventListener("click",()=>this.downloadAudio());const l=document.getElementById("grooveCanvas");l.addEventListener("mousedown",a=>this._onDragStart(a)),l.addEventListener("mousemove",a=>this._onDragMove(a)),l.addEventListener("mouseup",a=>this._onDragEnd()),l.addEventListener("mouseleave",a=>this._onDragEnd()),l.addEventListener("touchstart",a=>this._onDragStart(a.touches[0]),{passive:!0}),l.addEventListener("touchmove",a=>{a.preventDefault(),this._onDragMove(a.touches[0])},{passive:!1}),l.addEventListener("touchend",a=>this._onDragEnd()),["quality","turns","sensitivity","speed"].forEach(a=>{const r=document.getElementById(`${a}Slider`),s=document.getElementById(`${a}Value`);r.addEventListener("input",d=>{s.textContent=a==="speed"?`${d.target.value}x`:d.target.value})}),document.querySelectorAll(".tab-btn").forEach(a=>{a.addEventListener("click",()=>{document.querySelectorAll(".tab-btn").forEach(r=>r.classList.remove("active")),document.querySelectorAll(".tab-panel").forEach(r=>r.classList.remove("active")),a.classList.add("active"),document.getElementById(`tab-${a.dataset.tab}`).classList.add("active")})}),document.getElementById("skinClassic").addEventListener("click",()=>this._applySkin(I.classic)),document.getElementById("skinVagc77").addEventListener("click",()=>this._applySkin(I.vagc77)),document.getElementById("skinOmitron").addEventListener("click",()=>this._applySkin(I.omitron)),document.getElementById("skinOwl").addEventListener("click",()=>this._applySkin(I.owl)),document.getElementById("skinEq").addEventListener("click",()=>this._applySkin(I.eq)),document.getElementById("skinLoad").addEventListener("click",()=>document.getElementById("skinFileInput").click()),document.getElementById("skinFileInput").addEventListener("change",a=>{const r=a.target.files[0];r&&(r.text().then(s=>{try{const d=this.skinManager.load(s);this.renderer.setSkin(d.canvas,this.groovePoints,this._geom()),this._redraw(),this._updateSkinButtons(d)}catch(d){this._statusError(`Failed to load skin: ${d.message}`)}}),a.target.value="")}),document.getElementById("skinExport").addEventListener("click",()=>{var s;const a=this.skinManager.export(),r=(((s=this.skinManager.current)==null?void 0:s.name)||"skin").replace(/\s+/g,"-");this._triggerDownload(new Blob([a],{type:"application/json"}),`${r}.skin.json`)})}async loadAudioFile(t){var n;this.debug(`Loading audio file: ${t.name}`),this._setStatus("Loading audio file...","info");try{const e=await new(window.AudioContext||window.webkitAudioContext)().decodeAudioData(await t.arrayBuffer());this.originalAudio=e.getChannelData(0),this.originalAudioR=e.numberOfChannels>1?e.getChannelData(1):null,this.sampleRate=e.sampleRate,this.duration=e.duration,this.decodedAudio=null,this.decodedAudioR=null;const l=e.numberOfChannels===1?"Mono":"Stereo";this._setStatus(`Audio loaded: ${t.name}`,"success"),this._showAudioInfo({duration:e.duration,sampleRate:e.sampleRate,channels:l,size:`${(t.size/1024/1024).toFixed(1)} MB`}),document.getElementById("generateGroove").disabled=!1,(n=document.getElementById("dropOverlay"))==null||n.classList.add("hidden"),this.debug(`Audio loaded: ${this.originalAudio.length} samples, ${this.sampleRate}Hz, ${this.duration.toFixed(2)}s${this.originalAudioR?" [stereo]":""}`)}catch(o){this.debug(`Failed to load audio: ${o.message}`),this._setStatus("Failed to load audio file","error")}}async loadGrooveFile(t){var n;this.debug(`Loading visual groove file: ${t.name}`),this._setStatus("Loading visual groove...","info");try{const o=await t.text(),e=yt(o,this._geom());this.grooveSVG=o,this.decodedAudio=e.samples,this.decodedAudioR=e.samplesR||null,this.sampleRate=e.sampleRate,this.duration=e.samples.length/e.sampleRate,this.spiralTurns=e.turns,this.Rout=e.Rout,this.Rin=e.Rin,this.cx=e.cx,this.cy=e.cy,this.originalAudio=null,this.originalAudioR=null,this.groovePoints=e.groovePoints;const l=e.samplesR?"Stereo (Visual)":"Mono (Visual)";this._setStatus(`Visual groove loaded: ${t.name}`,"success"),this._showAudioInfo({duration:this.duration,sampleRate:e.sampleRate,channels:l,size:`${(t.size/1024).toFixed(1)} KB`}),this.scrubProgress=0,this.discRotation=0,this.renderer.preRenderGroove(this.groovePoints,this._geom()),this.renderer.drawDiscWithGroove(0,-1,this._geom()),this.renderer.canvas.style.cursor="grab",this._enablePlayback(),(n=document.getElementById("dropOverlay"))==null||n.classList.add("hidden");const i=document.getElementById("generateGroove");i.textContent="RE-ENC",i.disabled=!1,this.debug(`Groove loaded: ${e.vertices} vertices, ${e.turns.toFixed(1)} turns, ${this.duration.toFixed(2)}s${e.samplesR?" [stereo M/S]":""}`),this.debug("Ready for playback from visual groove!")}catch(o){this.debug(`Failed to load groove: ${o.message}`),this._setStatus("Failed to load visual groove file","error"),console.error("Groove loading error:",o)}}generateGroove(){if(!this.originalAudio){this._statusError("Please load an audio file first");return}const t=document.getElementById("generateGroove");t.classList.add("loading"),t.textContent="WAIT...",t.disabled=!0,this.debug(`Starting encoding: ${this.originalAudio.length} samples...`),this._setStatus(`Encoding ${this.originalAudio.length} samples...`,"info"),setTimeout(()=>{try{const n=parseInt(document.getElementById("qualitySlider").value),o=parseInt(document.getElementById("turnsSlider").value),e=parseInt(document.getElementById("sensitivitySlider").value);this.spiralTurns=o;const{svg:l,groovePoints:i,debugMsg:a}=Tt(this.originalAudio,{sr:this.sampleRate,quality:n,turns:o,sensitivity:e,...this._geom(),rightChannel:this.originalAudioR});this.grooveSVG=l,this.groovePoints=i,this.scrubProgress=0,this.discRotation=0,this.debug(a),this.renderer.preRenderGroove(i,this._geom()),this.renderer.drawDiscWithGroove(0,-1,this._geom()),this.renderer.canvas.style.cursor="grab",this._enablePlayback();const r=l.length,s=r>1024*1024?`${(r/1024/1024).toFixed(1)} MB`:`${(r/1024).toFixed(0)} KB`;this.debug(`Groove generated: ${s} SVG`),this._setStatus(`Groove generated (${s}). Ready for playback!`,"success")}catch(n){this.debug(`Groove generation failed: ${n.message}`),this._setStatus("Failed to generate groove","error")}t.classList.remove("loading"),t.textContent="ENCODE",t.disabled=!1},100)}async startPlayback(){var e;if(!this.grooveSVG)return;const t=this._getPlaybackAudio();if(!t){this.debug("Failed to decode audio from groove");return}const n=parseFloat(document.getElementById("speedSlider").value),o=t.right?"stereo":"mono";this.debug(`Starting groove playback... Speed: ${n}x | ${t.left.length} samples @ ${t.sampleRate}Hz [${o}]`),document.getElementById("playBtn").style.display="none",document.getElementById("pauseBtn").style.display="inline-block",document.getElementById("pauseBtn").disabled=!1,(e=document.getElementById("playWrap"))==null||e.classList.add("playing"),cancelAnimationFrame(this._spindownId),this._spinRate=0,this._lastFrameTime=performance.now(),await this.playback.start(t,n,this.scrubProgress)}downloadSVG(){this.grooveSVG&&(this._triggerDownload(new Blob([this.grooveSVG],{type:"image/svg+xml"}),"visual_audio_groove.svg"),this.debug("Visual groove SVG downloaded"))}downloadAudio(){const t=this._getPlaybackAudio();t&&(this._triggerDownload(this.playback.createWAVBlob(t),"reconstructed_audio.wav"),this.debug(`Reconstructed audio downloaded${t.right?" [stereo]":""}`))}_canvasAngle(t,n){const o=this.renderer.canvas,e=o.getBoundingClientRect(),l=o.width/e.width,i=(t-e.left)*l,a=(n-e.top)*l,r=o.width/520,s=this.cx*r,d=this.cy*r;return{angle:Math.atan2(a-d,i-s),dist:Math.hypot(i-s,a-d),drawScale:r}}_onDragStart(t){if(!this.groovePoints)return;const{angle:n,dist:o,drawScale:e}=this._canvasAngle(t.clientX,t.clientY),l=(this.Rout+8)*e,i=Math.max(12,this.Rin-8)*e;o<i||o>l||(this.isDragging=!0,this.dragLastAngle=n,this.dragLastTime=performance.now(),this.scratchVel=0,this._lastFrameTime=performance.now(),this.renderer.canvas.style.cursor="grabbing",this.playback.setRate(0))}_onDragMove(t){if(!this.isDragging)return;const n=performance.now(),o=Math.max(n-this.dragLastTime,1)/1e3,{angle:e}=this._canvasAngle(t.clientX,t.clientY);let l=e-this.dragLastAngle;l>Math.PI&&(l-=p),l<-Math.PI&&(l+=p),this.dragLastAngle=e,this.dragLastTime=n;const i=l/o;this.scratchVel=.6*this.scratchVel+.4*i;const a=this.spiralTurns*p/Math.max(this.duration,.001),r=this.scratchVel/a;this.playback.setRate(r),this.discRotation+=l,this.scrubProgress=Math.max(0,Math.min(1,this.scrubProgress+l/(this.spiralTurns*p))),this.renderer.drawDiscWithGroove(this.discRotation,this.scrubProgress,this._geom()),document.getElementById("currentTime").textContent=this._formatTime(this.scrubProgress*this.duration),clearTimeout(this._dragIdleTimer),this._dragIdleTimer=setTimeout(()=>{this.isDragging&&(this.scratchVel=0,this.playback.setRate(0))},80)}_onDragEnd(){if(!this.isDragging)return;this.isDragging=!1,clearTimeout(this._dragIdleTimer),this.renderer.canvas.style.cursor=this.groovePoints?"grab":"default",this._lastFrameTime=performance.now();const t=parseFloat(document.getElementById("speedSlider").value);this.playback.setRate(t)}_applySkin(t){this.skinManager.apply(t),this.renderer.setSkin(t.canvas,this.groovePoints,this._geom()),this._redraw(),this._updateSkinButtons(t)}_redraw(){this.groovePoints?this.renderer.drawDiscWithGroove(this.discRotation,this.scrubProgress,this._geom()):this.renderer.drawEmptyDisc(this._geom())}_updateSkinButtons(t){document.getElementById("skinClassic").classList.toggle("active",t===I.classic),document.getElementById("skinVagc77").classList.toggle("active",t===I.vagc77),document.getElementById("skinOmitron").classList.toggle("active",t===I.omitron),document.getElementById("skinOwl").classList.toggle("active",t===I.owl),document.getElementById("skinEq").classList.toggle("active",t===I.eq)}debug(t){const n=new Date().toLocaleTimeString(),o=document.getElementById("debugLog"),e=document.createElement("div");e.textContent=`[${n}] ${t}`,o.appendChild(e),o.scrollTop=o.scrollHeight,console.log(`[${n}] ${t}`)}_getPlaybackAudio(){if(this.decodedAudio)return{left:this.decodedAudio,right:this.decodedAudioR||null,sampleRate:this.sampleRate};if(!this.grooveSVG)return null;const t=yt(this.grooveSVG,this._geom());return{left:t.samples,right:t.samplesR||null,sampleRate:t.sampleRate}}_startSpindown(){cancelAnimationFrame(this._spindownId),this._lastFrameTime=performance.now();const t=()=>{const n=performance.now(),o=Math.min((n-this._lastFrameTime)/1e3,.05);this._lastFrameTime=n,this._spinRate=Math.max(0,this._spinRate-.7*o),this.discRotation+=o*bt*this._spinRate,this.groovePoints&&this.renderer.drawDiscWithGroove(this.discRotation,this.scrubProgress,this._geom()),this._spinRate>0&&(this._spindownId=requestAnimationFrame(t))};this._spindownId=requestAnimationFrame(t)}_enablePlayback(){document.getElementById("totalTime").textContent=this._formatTime(this.duration),["playBtn","downloadSVG","downloadAudio"].forEach(t=>{document.getElementById(t).disabled=!1})}_showAudioInfo({duration:t,sampleRate:n,channels:o,size:e}){document.getElementById("infoDuration").textContent=this._formatTime(t),document.getElementById("infoSampleRate").textContent=`${n} Hz`,document.getElementById("infoChannels").textContent=o,document.getElementById("infoSize").textContent=e}_setStatus(t,n="info"){const o=document.getElementById("audioStatus");o.textContent=t,o.className=`status-line ${n}`}_statusError(t){this.debug(t),this._setStatus(t,"error")}_formatTime(t){const n=Math.floor(t/60),o=Math.floor(t%60).toString().padStart(2,"0");return`${n}:${o}`}_triggerDownload(t,n){const o=URL.createObjectURL(t),e=document.createElement("a");e.href=o,e.download=n,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(o)}}window.addEventListener("load",()=>new Jt);
